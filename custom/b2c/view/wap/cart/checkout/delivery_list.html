
<{*<{foreach from=$shippings item="shipping" key="key" name="shippings"}>*}>
<{*<li class="shipping-item gb" value='{"id":<{$shipping.dt_id}>,"has_cod":"<{$shipping.has_cod}>","dt_name":"<{$shipping.dt_name}>","money":"<{$shipping.money}>"}'>*}>
    <{*<div class="col2">*}>
        <{*<div class="col"><{$shipping.dt_name}></div>*}>
        <{*<div class="col t-r">运费：<span class="f-red"><{$shipping.money|cur_odr}></span>元</div>*}>
    <{*</div>*}>
<{*</li>*}>
<{*<{/foreach}>*}>
<div class="full-screen">
    <div id="zxps" class="paiing" >
    	<dl>
        <{foreach from=$shippings item="shipping" key="key" name="shippings"}>
        <dd class="paiing-span<{if $smarty.get.id eq $shipping.dt_id}> selected<{/if}>" value='{"id":<{$shipping.dt_id}>,"has_cod":"<{$shipping.has_cod}>","dt_name":"<{$shipping.dt_name}>","money":"<{$shipping.money}>"}'><{$shipping.dt_name}></dd>    <!-- 当前选中状态  加样式   selected  -->
        <{/foreach}>
        </dl>
    </div>


    <div style="<{if $smarty.get.id neq 2}>display:none;<{/if}>"  class="ps-div" id="select_zt">
        <div class="ps-div-title">自提地点</div>                <!-- 弹出选择框选择  -->
        <{foreach from=$branchlist item="branchs"}>
        <div class="ps-div-address" value='<{$branchs.branch_id}>'><{$branchs.name}></div>
        <{/foreach}>
    </div>
    
    <div class="invoice no-border">
        <a id="submit_del" href="javascript:;" class="invoice_submit">确定</a>
    </div>
</div>
<script>
    $('#zxps .paiing-span').click(function () {
        $('#zxps .paiing-span').removeClass('selected');
        $(this).addClass('selected');
        var data = $.parseJSON($(this).attr('value'));
        if(data.dt_name == '门店自提'){
            $('#select_zt').show();
        }else{
            $('#select_zt').hide();
        }
    });
    
    $('#select_zt .ps-div-address').click(function () {
    	$('#select_zt .ps-div-address').removeClass('selected');
    	$(this).addClass('selected');
    });

    $('#submit_del').click(function(){
        var data = 'shipping='+$('#zxps .selected').attr('value');
        
        var selectedData = $.parseJSON($('#zxps .selected').attr('value'));
        
        if (selectedData.dt_name == '门店自提') {
        	if ($('#select_zt .selected').attr('value') == undefined) {
        		alert('请选择自提门店');return ;
        	}
        	data = data + "&branch_id="+ $('#select_zt .selected').attr('value');
        }
        var url = '<{link app=b2c ctl=wap_cart act=delivery_confirm}>';
        $.post(url,data,function(re){
            if(re){
                location.href = '<{link app=b2c ctl=wap_cart act=checkout}>';
            }
        });
    });
</script>
